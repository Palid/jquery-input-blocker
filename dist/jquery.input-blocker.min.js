/*! input-blocker - v1.0.1 - 2014-11-10
* https://github.com/Palid/input-blocker
* Copyright (c) 2014 Dariusz 'Palid' Niemczyk; Licensed GNU */
!function(a){"use strict";function b(a){return{start:a.selectionStart,end:a.selectionEnd}}function c(a){var c=a.which||a.keyCode;return this.inputBlocker.__lastSelection__=b(this),this.inputBlocker.__lastValue__=this.value,a.ctrlKey&&!a.altKey?(this.inputBlocker.__passEvent__=!1,!0):h[c]?(this.inputBlocker.__passEvent__=!1,this.inputBlocker.__lastKey__=h[c],!0):void(this.inputBlocker.__passEvent__=!0)}function d(a){var b=a.which||a.keyCode,c=String.fromCharCode(b);return this.inputBlocker.__passEvent__?(this.inputBlocker.__lastKey__=c,this.inputBlocker.__allowedRe__.test(c)?(this.inputBlocker.__lastAllowedKey__=c,!0):!1):!0}function e(){var b=a(this),c=-1!==this.maxLength&&524288!==this.maxLength?this.maxLength:-1,d=this.inputBlocker,e=new RegExp(d.__allowedRe__.source||d.__allowedRe__.toSource(),"g"),f=d.__lastPasteData__.match(e);if(d.__trimOnPaste__&&(d.__lastPasteData__=a.trim(d.__lastPasteData__)),f&&f.join("")===d.__lastPasteData__){var g=d.__lastValue__?a.inputBlocker.concatPasted(d.__lastValue__,d.__lastPasteData__,d.__lastSelection__):d.__lastPasteData__;this.value=-1===c||g.length<=c?g:d.__lastValue__}else this.value=d.__lastValue__;b.trigger("keydown"),a.inputBlocker.restoreCaretPosition(b,d.__lastSelection__,d.__lastPasteData__.length)}function f(){var b=this.value;b?(this.inputBlocker.__lastPasteData__=b,e.call(this)):setTimeout(function(){return a.inputBlocker.waitForPaste.call(this)},20)}function g(a){return this.inputBlocker.__canPaste__?(this.inputBlocker.__lastSelection__=b(this),this.inputBlocker.__lastValue__=this.value,a.originalEvent&&a.originalEvent.clipboardData&&a.originalEvent.clipboardData.getData?(this.inputBlocker.__lastPasteData__=a.originalEvent.clipboardData.getData("text/plain"),e.call(this),!1):(this.value="",f.call(this),!1)):!1}var h={37:"left arrow",39:"right arrow",8:"backspace",46:"delete",45:"insert",36:"home",35:"end",33:"page up",34:"page down",9:"tab",ctrlKey:"control",altKey:"alt",shiftKey:"shift"};a.inputBlocker={},a.inputBlocker.options={canPaste:!0,allowedRe:/./,maxLength:void 0,trimOnPaste:!0},a.fn.inputBlocker=function(b){var c=b;return"string"!=typeof c||"destroy"!==c&&"clear"!==c?(c=a.extend(a.inputBlocker.options,b),this.each(function(){a.extend(c,{node:this,$el:a(this)}),a.inputBlocker.setValidation(c)}),this):a.inputBlocker.clearValidation(this)},a.inputBlocker.setValidation=function(b){if(b.$el.hasClass("jquery-input-blocker"))throw b.$el.selector+" already has input-blocker initialized.";a.extend(b.node,{inputBlocker:{__preInitMaxLength__:b.node.maxLength,__preInitValue__:b.node.value,__lastValue__:b.node.value,__passEvent__:!0,__trimOnPaste__:b.trimOnPaste,__canPaste__:b.canPaste,__allowedRe__:b.allowedRe,__lastSelection__:{start:0,end:0},__lastPasteData__:"",__lastAllowedKey__:"",__lastKey__:""}}),-1!==b.maxlength&&524288!==b.maxlength&&b.$el.prop("maxlength",b.maxlength),b.$el.addClass("jquery-input-blocker").on("keydown.inputBlocker",c).on("keypress.inputBlocker",d).on("paste.inputBlocker",g)},a.inputBlocker.clearValidation=function(a){if(a.hasClass("jquery-input-blocker")){for(var b=a.get(),e=b.length,f=0;e>f;f++)-1===b[f].inputBlocker.__preInitMaxLength__?b[f].removeAttribute("maxLength"):b[f].maxLength=b[f].inputBlocker.__preInitMaxLength__,b[f].inputBlocker=void 0;a.off("keydown.inputBlocker",a,a.selector,c).off("keypress.inputBlocker",a,a.selector,d).off("paste.inputBlocker",a,a.selector,g).removeClass("jquery-input-blocker")}},a.inputBlocker.concatPasted=function(a,b,c){var d=a.split(""),e=c.end-c.start;return d.splice(c.start,e,b),d.join("")},a.inputBlocker.restoreCaretPosition=function(a,b,c){var d=a.prop("selectionStart"),e=d?b.start+c:b.end+c;d?(a.focus(),a.prop({selectionStart:e,selectionEnd:e})):a.prop("selectionEnd")&&(a.focus(),a.prop({selectionStart:e,selectionEnd:e}))},a.expr[":"].inputBlocker=function(a){return a.inputBlocker}}(jQuery);